<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FreeClaw - Your AI Chatbot in 2 Minutes</title>
  <meta name="description" content="Set up your own AI chatbot on your computer in 2 minutes. No coding required. Powered by OpenClaw.">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><text y='28' font-size='28'>ðŸ¦ž</text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg: #07080a;
  --bg-card: #0e0f13;
  --bg-card-hover: #141519;
  --bg-input: #0b0c10;
  --text: #ededed;
  --text-secondary: #9f9fa9;
  --text-muted: #5a5b65;
  --accent: #7c3aed;
  --accent-blue: #3b82f6;
  --accent-green: #10b981;
  --accent-red: #ef4444;
  --accent-amber: #f59e0b;
  --border: rgba(255,255,255,0.08);
  --border-hover: rgba(255,255,255,0.16);
  --ring: rgba(255,255,255,0.12);
  --radius: 12px;
  --radius-sm: 8px;
  --radius-lg: 16px;
  --font: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  --transition: 0.15s cubic-bezier(.4,0,.2,1);
}

html { scroll-behavior: smooth; }

body {
  font-family: var(--font);
  background: var(--bg);
  color: var(--text);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  min-height: 100vh;
  overflow-x: hidden;
  line-height: 1.6;
}

/* Ambient background */
.ambient {
  position: fixed; inset: 0; z-index: 0; pointer-events: none; overflow: hidden;
}
.ambient::before {
  content: '';
  position: absolute;
  top: -40%; left: -20%;
  width: 60%; height: 80%;
  background: radial-gradient(ellipse, rgba(124,58,237,0.06) 0%, transparent 70%);
}
.ambient::after {
  content: '';
  position: absolute;
  bottom: -30%; right: -20%;
  width: 50%; height: 70%;
  background: radial-gradient(ellipse, rgba(59,130,246,0.04) 0%, transparent 70%);
}

/* Layout */
.container {
  position: relative; z-index: 1;
  max-width: 640px;
  margin: 0 auto;
  padding: 2rem 1.5rem 4rem;
}

/* Progress bar */
.progress-bar {
  display: flex; gap: 6px;
  margin-bottom: 2.5rem;
}
.progress-dot {
  flex: 1; height: 3px;
  background: rgba(255,255,255,0.08);
  border-radius: 2px;
  transition: background var(--transition);
}
.progress-dot.active { background: var(--accent); }
.progress-dot.done { background: var(--accent-green); }

/* Steps */
.step { display: none; animation: fadeIn 0.3s ease; }
.step.active { display: block; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: none; } }

/* Typography */
h1 {
  font-size: 2rem; font-weight: 700; letter-spacing: -0.03em; line-height: 1.2;
  margin-bottom: 0.75rem;
}
h1 .gradient {
  background: linear-gradient(135deg, #fff 0%, rgba(255,255,255,0.6) 100%);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  background-clip: text;
}
h2 { font-size: 1.5rem; font-weight: 600; letter-spacing: -0.02em; margin-bottom: 0.5rem; }
.subtitle { color: var(--text-secondary); font-size: 1.05rem; margin-bottom: 2rem; line-height: 1.5; }
.section-label { font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-muted); margin-bottom: 0.75rem; }

/* Cards */
.card {
  background: var(--bg-card);
  border-radius: var(--radius);
  border: 1px solid var(--border);
  padding: 1.25rem;
  transition: all var(--transition);
  cursor: pointer;
  position: relative;
}
.card::before {
  content: ''; position: absolute; inset: 0;
  border-radius: var(--radius);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.04);
  pointer-events: none;
}
.card:hover { background: var(--bg-card-hover); border-color: var(--border-hover); }
.card.selected {
  border-color: var(--accent);
  box-shadow: 0 0 0 1px var(--accent), 0 0 20px rgba(124,58,237,0.1);
}
.card-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 1.5rem; }
.card-grid.three { grid-template-columns: 1fr 1fr 1fr; }
@media (max-width: 480px) { .card-grid, .card-grid.three { grid-template-columns: 1fr; } }

.card-icon { width: 36px; height: 36px; margin-bottom: 0.75rem; color: var(--text-secondary); }
.card-title { font-weight: 600; font-size: 0.95rem; margin-bottom: 0.25rem; }
.card-desc { font-size: 0.8rem; color: var(--text-secondary); }
.card .badge {
  position: absolute; top: 0.75rem; right: 0.75rem;
  font-size: 0.65rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em;
  padding: 0.2rem 0.5rem; border-radius: 4px;
  background: rgba(124,58,237,0.15); color: #a78bfa;
}

/* Buttons */
.btn {
  display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem;
  padding: 0.75rem 1.5rem;
  border-radius: var(--radius-sm);
  font-family: var(--font); font-size: 0.9rem; font-weight: 500;
  border: none; cursor: pointer;
  transition: all var(--transition);
}
.btn-primary {
  background: linear-gradient(135deg, var(--accent), var(--accent-blue));
  color: #fff;
  box-shadow: 0 0 20px rgba(124,58,237,0.15), inset 0 1px 0 rgba(255,255,255,0.15);
}
.btn-primary:hover { box-shadow: 0 0 30px rgba(124,58,237,0.25), inset 0 1px 0 rgba(255,255,255,0.2); transform: translateY(-1px); }
.btn-primary:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }
.btn-secondary {
  background: rgba(255,255,255,0.06); color: var(--text); border: 1px solid var(--border);
}
.btn-secondary:hover { background: rgba(255,255,255,0.1); border-color: var(--border-hover); }
.btn-large { padding: 1rem 2rem; font-size: 1.05rem; border-radius: var(--radius); }
.btn-row { display: flex; justify-content: space-between; align-items: center; margin-top: 2rem; }
.btn-row .btn-secondary { padding: 0.6rem 1.2rem; }

/* Form inputs */
.input-group { margin-bottom: 1.25rem; }
.input-label { display: block; font-size: 0.8rem; font-weight: 500; margin-bottom: 0.4rem; color: var(--text-secondary); }
.input-wrap {
  position: relative;
  display: flex; align-items: center;
  background: var(--bg-input);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  transition: border-color var(--transition);
}
.input-wrap:focus-within { border-color: var(--accent); box-shadow: 0 0 0 2px rgba(124,58,237,0.15); }
.input-wrap input, .input-wrap textarea {
  flex: 1; width: 100%;
  padding: 0.7rem 0.85rem;
  background: none; border: none; outline: none;
  color: var(--text); font-family: var(--font); font-size: 0.9rem;
}
.input-wrap textarea { min-height: 80px; resize: vertical; line-height: 1.5; }
.input-wrap input::placeholder, .input-wrap textarea::placeholder { color: var(--text-muted); }
.input-toggle {
  padding: 0.5rem; margin-right: 0.25rem;
  background: none; border: none; cursor: pointer; color: var(--text-muted);
  display: flex; align-items: center;
}
.input-toggle:hover { color: var(--text-secondary); }
.input-hint { font-size: 0.75rem; color: var(--text-muted); margin-top: 0.3rem; }
.input-error { font-size: 0.75rem; color: var(--accent-red); margin-top: 0.3rem; display: none; }
.input-success { font-size: 0.75rem; color: var(--accent-green); margin-top: 0.3rem; display: none; }

/* Expandable */
.expandable { margin-top: 1rem; }
.expandable-toggle {
  display: flex; align-items: center; gap: 0.5rem;
  background: none; border: none; cursor: pointer;
  color: var(--text-secondary); font-family: var(--font); font-size: 0.85rem;
  padding: 0.5rem 0;
}
.expandable-toggle:hover { color: var(--text); }
.expandable-toggle svg { width: 16px; height: 16px; transition: transform var(--transition); }
.expandable-toggle.open svg { transform: rotate(90deg); }
.expandable-content {
  display: none; padding: 0.75rem 0;
  color: var(--text-secondary); font-size: 0.85rem; line-height: 1.6;
}
.expandable-content.open { display: block; }

/* Notice box */
.notice {
  background: rgba(124,58,237,0.06);
  border: 1px solid rgba(124,58,237,0.15);
  border-radius: var(--radius-sm);
  padding: 1rem 1.25rem;
  font-size: 0.85rem; line-height: 1.6;
  color: var(--text-secondary);
  margin-bottom: 1.5rem;
}
.notice.warning {
  background: rgba(245,158,11,0.06);
  border-color: rgba(245,158,11,0.15);
}
.notice.security {
  background: rgba(16,185,129,0.06);
  border-color: rgba(16,185,129,0.15);
}
.notice a { color: var(--accent); text-decoration: none; }
.notice a:hover { text-decoration: underline; }

/* Steps list */
.steps-list { list-style: none; counter-reset: step; margin: 1rem 0; }
.steps-list li {
  counter-increment: step;
  padding: 0.6rem 0 0.6rem 2.5rem;
  position: relative;
  font-size: 0.9rem; color: var(--text-secondary); line-height: 1.5;
}
.steps-list li::before {
  content: counter(step);
  position: absolute; left: 0; top: 0.5rem;
  width: 1.75rem; height: 1.75rem;
  background: rgba(124,58,237,0.12); color: #a78bfa;
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 0.75rem; font-weight: 600;
}
.steps-list li code {
  background: rgba(255,255,255,0.06); padding: 0.15rem 0.4rem;
  border-radius: 4px; font-size: 0.82rem;
}

/* Personality cards */
.personality-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 1.25rem; }
.personality-grid .card { padding: 1rem; }
.personality-grid .card:nth-child(5) { grid-column: 1 / -1; }
.personality-sample {
  font-size: 0.78rem; color: var(--text-muted);
  font-style: italic; margin-top: 0.5rem;
  line-height: 1.4;
}
@media (max-width: 480px) { .personality-grid { grid-template-columns: 1fr; } .personality-grid .card:nth-child(5) { grid-column: auto; } }

/* Download section */
.download-box {
  text-align: center;
  padding: 2rem;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  margin: 1.5rem 0;
}
.download-box .btn { margin-top: 1rem; }
.download-note { font-size: 0.8rem; color: var(--text-muted); margin-top: 0.75rem; }

/* Success page */
.success-check {
  width: 64px; height: 64px;
  margin: 0 auto 1.5rem;
  background: rgba(16,185,129,0.1);
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  animation: scaleIn 0.5s cubic-bezier(.34,1.56,.64,1);
}
@keyframes scaleIn { from { transform: scale(0); } to { transform: scale(1); } }
.success-check svg { width: 32px; height: 32px; color: var(--accent-green); }
.success-section { text-align: center; margin: 2rem 0; }
.donate-btn {
  display: inline-flex; align-items: center; gap: 0.5rem;
  padding: 0.75rem 1.5rem;
  background: rgba(245,158,11,0.1); border: 1px solid rgba(245,158,11,0.2);
  border-radius: var(--radius-sm);
  color: #fbbf24; font-family: var(--font); font-size: 0.9rem; font-weight: 500;
  text-decoration: none; transition: all var(--transition);
}
.donate-btn:hover { background: rgba(245,158,11,0.15); }
.share-row { display: flex; gap: 0.75rem; justify-content: center; margin-top: 1rem; }
.share-btn {
  padding: 0.6rem 1rem;
  background: rgba(255,255,255,0.06); border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  color: var(--text-secondary); font-family: var(--font); font-size: 0.82rem;
  cursor: pointer; transition: all var(--transition); text-decoration: none;
}
.share-btn:hover { background: rgba(255,255,255,0.1); color: var(--text); }

/* Help button */
.help-fab {
  position: fixed; bottom: 1.5rem; right: 1.5rem; z-index: 100;
  padding: 0.7rem 1rem;
  background: var(--bg-card); border: 1px solid var(--border);
  border-radius: 999px;
  color: var(--text-secondary); font-family: var(--font); font-size: 0.82rem;
  cursor: pointer; display: flex; align-items: center; gap: 0.4rem;
  transition: all var(--transition);
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}
.help-fab:hover { border-color: var(--border-hover); color: var(--text); }

/* Help panel */
.help-overlay {
  display: none; position: fixed; inset: 0; z-index: 200;
  background: rgba(0,0,0,0.5); backdrop-filter: blur(4px);
}
.help-overlay.open { display: flex; justify-content: flex-end; }
.help-panel {
  width: 380px; max-width: 90vw; height: 100%;
  background: var(--bg); border-left: 1px solid var(--border);
  padding: 1.5rem; overflow-y: auto;
  animation: slideIn 0.2s ease;
}
@keyframes slideIn { from { transform: translateX(100%); } to { transform: none; } }
.help-panel h3 { font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; }
.help-close {
  position: absolute; top: 1rem; right: 1rem;
  background: none; border: none; color: var(--text-muted);
  cursor: pointer; font-size: 1.5rem; line-height: 1;
}
.help-close:hover { color: var(--text); }

/* FAQ */
.faq-item { border-bottom: 1px solid var(--border); }
.faq-q {
  display: flex; justify-content: space-between; align-items: center;
  padding: 0.85rem 0; cursor: pointer;
  font-size: 0.88rem; font-weight: 500; color: var(--text);
}
.faq-q:hover { color: var(--accent); }
.faq-a {
  display: none; padding: 0 0 0.85rem;
  font-size: 0.82rem; color: var(--text-secondary); line-height: 1.6;
}
.faq-a.open { display: block; }

/* Separator */
.sep { height: 1px; background: var(--border); margin: 2rem 0; }

/* Accordion for troubleshooting */
.accordion-item { border: 1px solid var(--border); border-radius: var(--radius-sm); margin-bottom: 0.5rem; }
.accordion-header {
  display: flex; justify-content: space-between; align-items: center;
  padding: 0.75rem 1rem; cursor: pointer;
  font-size: 0.88rem; font-weight: 500;
}
.accordion-header:hover { color: var(--accent); }
.accordion-body { display: none; padding: 0 1rem 0.75rem; font-size: 0.82rem; color: var(--text-secondary); line-height: 1.6; }
.accordion-body.open { display: block; }

/* Dynamic content area */
.dynamic-content { min-height: 100px; }

/* Link styles */
a.text-link { color: var(--accent); text-decoration: none; }
a.text-link:hover { text-decoration: underline; }

/* Footer links on success page */
.footer-links {
  display: flex; gap: 1.5rem; justify-content: center;
  margin-top: 2rem; padding-top: 1.5rem;
  border-top: 1px solid var(--border);
}
.footer-links a { color: var(--text-muted); font-size: 0.8rem; text-decoration: none; }
.footer-links a:hover { color: var(--text-secondary); }
  </style>
</head>
<body>
  <div class="ambient"></div>

  <div class="container">
    <div class="progress-bar" id="progressBar"></div>

    <!-- STEP 0: Welcome -->
    <div class="step active" data-step="0">
      <h1><span class="gradient">FreeClaw</span></h1>
      <p class="subtitle">Your own AI chatbot in 2 minutes. No coding required.</p>

      <div class="notice security">
        <strong>How it works:</strong> FreeClaw runs entirely in your browser. Your API keys and tokens are embedded in the downloaded file and never sent to our servers. You are responsible for your API key usage and costs.
        <br><br>
        FreeClaw is not affiliated with <a href="https://openclaw.ai/" target="_blank" rel="noopener">OpenClaw</a>. This is a community tool.
        <br><a href="https://docs.openclaw.ai/" target="_blank" rel="noopener">OpenClaw Documentation</a>
      </div>

      <div class="expandable">
        <button class="expandable-toggle" onclick="toggleExpand(this)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
          How does this work?
        </button>
        <div class="expandable-content">
          <ol class="steps-list">
            <li>This wizard collects your preferences (which AI, which chat app)</li>
            <li>It generates a small setup script file</li>
            <li>You download and run the script on your computer</li>
            <li>The script installs OpenClaw and configures your bot</li>
            <li>Your bot starts and you can chat with it</li>
          </ol>
        </div>
      </div>

      <div class="btn-row" style="justify-content:flex-end">
        <button class="btn btn-primary btn-large" onclick="goToStep(1)">Get Started</button>
      </div>
    </div>

    <!-- STEP 1: OS Selection -->
    <div class="step" data-step="1">
      <h2>What's your computer?</h2>
      <p class="subtitle">We'll generate the right setup file for your system.</p>
      <div class="card-grid" id="osCards">
        <div class="card" data-value="windows" onclick="selectCard('os','windows',this)">
          <svg class="card-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M3 12V6.75l7-1.05V12H3zm8-1.35V5.5l10-1.5V12H11V10.65zM3 13h7v6.3l-7-1.05V13zm8 0h10v7l-10-1.5V13z"/></svg>
          <div class="card-title">Windows</div>
          <div class="card-desc">Windows 10 or newer</div>
        </div>
        <div class="card" data-value="macos" onclick="selectCard('os','macos',this)">
          <svg class="card-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.8-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/></svg>
          <div class="card-title">macOS</div>
          <div class="card-desc">macOS 12 or newer</div>
        </div>
      </div>
      <p style="font-size:0.8rem;color:var(--text-muted)">If you're on a regular PC, choose Windows. If you have a Mac, choose macOS.</p>
      <div class="btn-row">
        <button class="btn btn-secondary" onclick="goToStep(0)">Back</button>
        <button class="btn btn-primary" id="step1Next" disabled onclick="goToStep(2)">Next</button>
      </div>
    </div>

    <!-- STEP 2: Chat Platform -->
    <div class="step" data-step="2">
      <h2>Where do you want to chat?</h2>
      <p class="subtitle">Pick the messaging app your bot will live in.</p>
      <div class="card-grid" id="platformCards">
        <div class="card" data-value="telegram" onclick="selectCard('chatPlatform','telegram',this)">
          <svg class="card-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0h-.056zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.96 6.504-1.36 8.63-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.479.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/></svg>
          <div class="card-title">Telegram</div>
          <div class="card-desc">Easiest - 2 minutes</div>
        </div>
        <div class="card" data-value="discord" onclick="selectCard('chatPlatform','discord',this)">
          <svg class="card-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.947 2.418-2.157 2.418z"/></svg>
          <div class="card-title">Discord</div>
          <div class="card-desc">Easy - 3 minutes</div>
        </div>
        <div class="card" data-value="whatsapp" onclick="selectCard('chatPlatform','whatsapp',this)">
          <svg class="card-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 0 1-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 0 1-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 0 1 2.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0 0 12.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 0 0 5.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 0 0-3.48-8.413z"/></svg>
          <div class="card-title">WhatsApp</div>
          <div class="card-desc">Moderate - QR code scan</div>
        </div>
        <div class="card" data-value="slack" onclick="selectCard('chatPlatform','slack',this)">
          <svg class="card-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M5.042 15.165a2.528 2.528 0 0 1-2.52 2.523A2.528 2.528 0 0 1 0 15.165a2.527 2.527 0 0 1 2.522-2.52h2.52v2.52zM6.313 15.165a2.527 2.527 0 0 1 2.521-2.52 2.527 2.527 0 0 1 2.521 2.52v6.313A2.528 2.528 0 0 1 8.834 24a2.528 2.528 0 0 1-2.521-2.522v-6.313zM8.834 5.042a2.528 2.528 0 0 1-2.521-2.52A2.528 2.528 0 0 1 8.834 0a2.528 2.528 0 0 1 2.521 2.522v2.52H8.834zM8.834 6.313a2.528 2.528 0 0 1 2.521 2.521 2.528 2.528 0 0 1-2.521 2.521H2.522A2.528 2.528 0 0 1 0 8.834a2.528 2.528 0 0 1 2.522-2.521h6.312zM18.956 8.834a2.528 2.528 0 0 1 2.522-2.521A2.528 2.528 0 0 1 24 8.834a2.528 2.528 0 0 1-2.522 2.521h-2.522V8.834zM17.688 8.834a2.528 2.528 0 0 1-2.523 2.521 2.527 2.527 0 0 1-2.52-2.521V2.522A2.527 2.527 0 0 1 15.165 0a2.528 2.528 0 0 1 2.523 2.522v6.312zM15.165 18.956a2.528 2.528 0 0 1 2.523 2.522A2.528 2.528 0 0 1 15.165 24a2.527 2.527 0 0 1-2.52-2.522v-2.522h2.52zM15.165 17.688a2.527 2.527 0 0 1-2.52-2.523 2.526 2.526 0 0 1 2.52-2.52h6.313A2.527 2.527 0 0 1 24 15.165a2.528 2.528 0 0 1-2.522 2.523h-6.313z"/></svg>
          <div class="card-title">Slack</div>
          <div class="card-desc">Moderate - 5 minutes</div>
        </div>
      </div>
      <div class="btn-row">
        <button class="btn btn-secondary" onclick="goToStep(1)">Back</button>
        <button class="btn btn-primary" id="step2Next" disabled onclick="goToStep(3)">Next</button>
      </div>
    </div>

    <!-- STEP 3: AI Model -->
    <div class="step" data-step="3">
      <h2>Choose your AI brain</h2>
      <p class="subtitle">Pick which AI will power your chatbot.</p>
      <div class="card-grid three" id="modelCards">
        <div class="card" data-value="anthropic" onclick="selectCard('aiProvider','anthropic',this)">
          <span class="badge">Recommended</span>
          <svg class="card-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M13.827 3.52h3.603L24 20.48h-3.603l-6.57-16.96zm-7.258 0h3.767L16.906 20.48h-3.674l-1.479-3.906H5.807l-1.472 3.906H.762L6.57 3.52zm.901 3.63L5.047 13.642h5.765L8.39 7.15h-.92z"/></svg>
          <div class="card-title">Claude</div>
          <div class="card-desc">by Anthropic</div>
        </div>
        <div class="card" data-value="openai" onclick="selectCard('aiProvider','openai',this)">
          <svg class="card-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M22.282 9.821a5.985 5.985 0 0 0-.516-4.91 6.046 6.046 0 0 0-6.51-2.9A6.065 6.065 0 0 0 4.981 4.18a5.998 5.998 0 0 0-3.998 2.9 6.046 6.046 0 0 0 .743 7.097 5.98 5.98 0 0 0 .51 4.911 6.051 6.051 0 0 0 6.515 2.9A5.985 5.985 0 0 0 13.26 24a6.056 6.056 0 0 0 5.772-4.206 5.99 5.99 0 0 0 3.997-2.9 6.056 6.056 0 0 0-.747-7.073zM13.26 22.43a4.476 4.476 0 0 1-2.876-1.04l.141-.081 4.779-2.758a.795.795 0 0 0 .392-.681v-6.737l2.02 1.168a.071.071 0 0 1 .038.052v5.583a4.504 4.504 0 0 1-4.494 4.494zM3.6 18.304a4.47 4.47 0 0 1-.535-3.014l.142.085 4.783 2.759a.771.771 0 0 0 .78 0l5.843-3.369v2.332a.08.08 0 0 1-.033.062L9.74 19.95a4.5 4.5 0 0 1-6.14-1.646zM2.34 7.896a4.485 4.485 0 0 1 2.366-1.973V11.6a.766.766 0 0 0 .388.676l5.815 3.355-2.02 1.168a.076.076 0 0 1-.071 0l-4.83-2.786A4.504 4.504 0 0 1 2.34 7.872zm16.597 3.855l-5.833-3.387L15.119 7.2a.076.076 0 0 1 .071 0l4.83 2.791a4.494 4.494 0 0 1-.676 8.105v-5.678a.79.79 0 0 0-.407-.667zm2.01-3.023l-.141-.085-4.774-2.782a.776.776 0 0 0-.785 0L9.409 9.23V6.897a.066.066 0 0 1 .028-.061l4.83-2.787a4.5 4.5 0 0 1 6.68 4.66zm-12.64 4.135l-2.02-1.164a.08.08 0 0 1-.038-.057V6.075a4.5 4.5 0 0 1 7.375-3.453l-.142.08L8.704 5.46a.795.795 0 0 0-.393.681zm1.097-2.365l2.602-1.5 2.602 1.5v3.001l-2.602 1.5-2.602-1.5z"/></svg>
          <div class="card-title">ChatGPT</div>
          <div class="card-desc">by OpenAI</div>
        </div>
        <div class="card" data-value="google" onclick="selectCard('aiProvider','google',this)">
          <svg class="card-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 11.366v3.6h5.2c-.436 2.07-2.372 3.624-5.2 3.624a5.997 5.997 0 0 1-5.994-5.994A5.997 5.997 0 0 1 12 6.602c1.44 0 2.796.508 3.852 1.44l2.604-2.604A9.957 9.957 0 0 0 12 2.994 9.01 9.01 0 0 0 2.994 12 9.01 9.01 0 0 0 12 21.006c7.422 0 9.006-6.936 8.076-9.636z"/></svg>
          <div class="card-title">Gemini</div>
          <div class="card-desc">by Google</div>
        </div>
      </div>
      <p class="input-hint">You'll need an API key from your chosen provider. We'll help you get one next.</p>
      <div class="btn-row">
        <button class="btn btn-secondary" onclick="goToStep(2)">Back</button>
        <button class="btn btn-primary" id="step3Next" disabled onclick="goToStep(4)">Next</button>
      </div>
    </div>

    <!-- STEP 4: Get Your Keys -->
    <div class="step" data-step="4">
      <h2>Set up your keys</h2>
      <p class="subtitle">Follow the steps below to get your API key and bot token.</p>

      <div class="dynamic-content" id="apiKeyGuide"></div>
      <div class="sep"></div>
      <div class="dynamic-content" id="platformGuide"></div>

      <div class="btn-row">
        <button class="btn btn-secondary" onclick="goToStep(3)">Back</button>
        <button class="btn btn-primary" id="step4Next" disabled onclick="goToStep(5)">Next</button>
      </div>
    </div>

    <!-- STEP 5: Personalize -->
    <div class="step" data-step="5">
      <h2>Make it yours</h2>
      <p class="subtitle">Give your bot a personality.</p>

      <div class="input-group">
        <label class="input-label">What should your bot call you?</label>
        <div class="input-wrap">
          <input type="text" id="userName" placeholder="Your name" maxlength="50" oninput="validateStep5()">
        </div>
      </div>

      <p class="section-label">Pick a personality</p>
      <div class="personality-grid" id="personalityCards">
        <div class="card" data-value="chill" onclick="selectCard('personality','chill',this)">
          <div class="card-title">Chill</div>
          <div class="personality-sample">"hey, looks like you need help with that email. here's a draft - tweak it if you want"</div>
        </div>
        <div class="card" data-value="professional" onclick="selectCard('personality','professional',this)">
          <div class="card-title">Professional</div>
          <div class="personality-sample">"I've prepared a draft response for your review. Please find it below."</div>
        </div>
        <div class="card" data-value="friendly" onclick="selectCard('personality','friendly',this)">
          <div class="card-title">Friendly</div>
          <div class="personality-sample">"Oh, I can totally help with that! Here's a draft I put together!"</div>
        </div>
        <div class="card" data-value="witty" onclick="selectCard('personality','witty',this)">
          <div class="card-title">Witty</div>
          <div class="personality-sample">"One email draft, coming right up. I'd say it's my best work, but I peak every time."</div>
        </div>
        <div class="card" data-value="minimal" onclick="selectCard('personality','minimal',this)">
          <div class="card-title">Minimal</div>
          <div class="personality-sample">"Draft attached. Let me know if you want changes."</div>
        </div>
      </div>

      <div class="input-group">
        <label class="input-label">Special instructions (optional)</label>
        <div class="input-wrap">
          <textarea id="customInstructions" placeholder="e.g., 'Always respond in Spanish' or 'You are a cooking expert'" maxlength="500" oninput="validateStep5()"></textarea>
        </div>
        <div class="input-hint">Up to 500 characters</div>
      </div>

      <div class="btn-row">
        <button class="btn btn-secondary" onclick="goToStep(4)">Back</button>
        <button class="btn btn-primary" id="step5Next" disabled onclick="goToStep(6)">Next</button>
      </div>
    </div>

    <!-- STEP 6: Download -->
    <div class="step" data-step="6">
      <h2>Your setup file is ready</h2>
      <p class="subtitle">Download it and run it on your computer.</p>

      <div class="download-box">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="1.5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
        <br>
        <button class="btn btn-primary btn-large" id="downloadBtn" onclick="downloadScript()">
          Download <span id="downloadFilename">freeclaw-setup</span>
        </button>
        <div class="download-note">~5 KB - contains your configuration</div>
      </div>

      <div class="notice warning">
        This file contains your API keys. Keep it private and don't share it with anyone.
      </div>

      <div class="expandable">
        <button class="expandable-toggle" onclick="toggleExpand(this)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
          What does this script do?
        </button>
        <div class="expandable-content">
          <ol class="steps-list">
            <li>Downloads Node.js (portable, doesn't change your system)</li>
            <li id="scriptStep2">Downloads Git (Windows only, portable)</li>
            <li>Installs OpenClaw (the AI chatbot engine)</li>
            <li>Writes your bot configuration and personality</li>
            <li>Sets up auto-start so your bot runs when you log in</li>
            <li>Opens your chat app so you can start talking</li>
          </ol>
        </div>
      </div>

      <div class="btn-row">
        <button class="btn btn-secondary" onclick="goToStep(5)">Back</button>
        <button class="btn btn-primary" onclick="goToStep(7)">Next: Run Instructions</button>
      </div>
    </div>

    <!-- STEP 7: Run It -->
    <div class="step" data-step="7">
      <h2>Run it</h2>
      <p class="subtitle">Follow these steps to start your bot.</p>

      <div id="runInstructions"></div>

      <p class="section-label" style="margin-top:1.5rem">Troubleshooting</p>
      <div class="accordion-item">
        <div class="accordion-header" onclick="toggleAccordion(this)">Script won't run <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg></div>
        <div class="accordion-body" id="troubleRun"></div>
      </div>
      <div class="accordion-item">
        <div class="accordion-header" onclick="toggleAccordion(this)">Blocked by antivirus <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg></div>
        <div class="accordion-body">Some antivirus programs block downloaded scripts. Temporarily pause your antivirus, run the script, then re-enable it. The script only downloads from official sources (nodejs.org, github.com).</div>
      </div>
      <div class="accordion-item">
        <div class="accordion-header" onclick="toggleAccordion(this)">Setup fails with an error <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg></div>
        <div class="accordion-body">Check that you have an internet connection and at least 500MB of free disk space. Try running the script again - some downloads can fail temporarily. Check the setup log file for details.</div>
      </div>

      <div class="btn-row">
        <button class="btn btn-secondary" onclick="goToStep(6)">Back</button>
        <button class="btn btn-primary" onclick="goToStep(8)">Done</button>
      </div>
    </div>

    <!-- STEP 8: Done -->
    <div class="step" data-step="8">
      <div style="text-align:center">
        <div class="success-check">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 6L9 17l-5-5"/></svg>
        </div>
        <h2>Your bot is live!</h2>
        <p class="subtitle" id="successMsg">Go chat with it.</p>
        <a class="btn btn-primary btn-large" id="openChatBtn" href="#" target="_blank" rel="noopener">Open Chat</a>
      </div>

      <div class="sep"></div>

      <div class="success-section">
        <p style="font-size:0.95rem;margin-bottom:0.75rem;color:var(--text-secondary)">FreeClaw is free and open source.</p>
        <p style="font-size:0.85rem;color:var(--text-muted);margin-bottom:1rem">If it saved you time, consider supporting development.</p>
        <a class="donate-btn" href="https://polar.sh/checkout?productId=b3f01423-1476-4359-9a0b-34bc397aac58" target="_blank" rel="noopener">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
          Support FreeClaw
        </a>
      </div>

      <div class="success-section">
        <p style="font-size:0.85rem;color:var(--text-muted);margin-bottom:0.75rem">Tell your friends</p>
        <div class="share-row">
          <button class="share-btn" onclick="copyShareText()">Copy share link</button>
          <a class="share-btn" id="tweetLink" href="#" target="_blank" rel="noopener">Share on X</a>
        </div>
      </div>

      <div class="footer-links">
        <a href="https://docs.openclaw.ai/" target="_blank" rel="noopener">OpenClaw Docs</a>
        <a href="https://github.com/andreycpu/freeclaw" target="_blank" rel="noopener">GitHub</a>
        <a href="https://discord.gg/clawd" target="_blank" rel="noopener">Discord</a>
      </div>
    </div>
  </div>

  <!-- Help FAB -->
  <button class="help-fab" onclick="openHelp()">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3M12 17h.01"/></svg>
    Need help?
  </button>

  <!-- Help Panel -->
  <div class="help-overlay" id="helpOverlay" onclick="if(event.target===this)closeHelp()">
    <div class="help-panel" style="position:relative">
      <button class="help-close" onclick="closeHelp()">&times;</button>
      <h3>Help</h3>
      <div id="helpContext"></div>
      <div class="sep"></div>
      <h3 style="font-size:0.95rem;margin-bottom:0.75rem">FAQ</h3>
      <div id="faqList"></div>
      <div class="sep"></div>
      <p style="font-size:0.82rem;color:var(--text-muted)">Still stuck?</p>
      <div style="display:flex;flex-direction:column;gap:0.5rem;margin-top:0.5rem">
        <a class="share-btn" href="https://discord.gg/clawd" target="_blank" rel="noopener" style="text-align:center">OpenClaw Discord</a>
        <a class="share-btn" href="https://github.com/andreycpu/freeclaw/issues" target="_blank" rel="noopener" style="text-align:center">Report an Issue</a>
      </div>
    </div>
  </div>

  <script>
/* ===========================================================================
   FreeClaw - Client-side wizard & script generator
   All logic runs in the browser. No data is sent anywhere.
   =========================================================================== */

// ---------------------------------------------------------------------------
// State
// ---------------------------------------------------------------------------
const state = {
  os: null,
  chatPlatform: null,
  aiProvider: null,
  apiKey: '',
  userName: '',
  personality: null,
  customInstructions: '',
  telegram: { botToken: '', botUsername: '' },
  discord: { token: '', serverId: '' },
  whatsapp: {},
  slack: { botToken: '', appToken: '' }
};

const TOTAL_STEPS = 9;

const providerMap = {
  anthropic: { model: 'anthropic/claude-sonnet-4-20250514', envVar: 'ANTHROPIC_API_KEY', authChoice: 'apiKey', authFlag: '--anthropic-api-key', prefix: 'sk-ant-', name: 'Anthropic', keyUrl: 'https://console.anthropic.com/settings/keys' },
  openai: { model: 'openai/gpt-4o', envVar: 'OPENAI_API_KEY', authChoice: 'openai-api-key', authFlag: '--openai-api-key', prefix: 'sk-', name: 'OpenAI', keyUrl: 'https://platform.openai.com/api-keys' },
  google: { model: 'google/gemini-2.0-flash', envVar: 'GEMINI_API_KEY', authChoice: 'gemini-api-key', authFlag: '--gemini-api-key', prefix: '', name: 'Google', keyUrl: 'https://aistudio.google.com/apikey' }
};

const personalities = {
  chill: "You are a chill, laid-back AI assistant. You keep things casual and relaxed. You use informal language but you're still helpful and knowledgeable. You might use slang occasionally. You don't overthink things - you give straightforward answers without being stiff about it.",
  professional: "You are a professional AI assistant. You communicate clearly and formally. You provide thorough, well-structured responses. You maintain a courteous and business-appropriate tone at all times.",
  friendly: "You are a warm, friendly AI assistant. You're enthusiastic and encouraging. You make people feel comfortable asking questions. You celebrate their wins and support them through challenges. You're like a knowledgeable friend who's always happy to help.",
  witty: "You are a witty, clever AI assistant. You enjoy wordplay and humor. You're sharp and quick with responses, often adding a touch of humor while still being genuinely helpful. You never sacrifice helpfulness for a joke, but you make the conversation enjoyable.",
  minimal: "You are a concise AI assistant. You give short, direct answers. No fluff, no filler. You respect the user's time and get straight to the point. You expand only when asked."
};

// ---------------------------------------------------------------------------
// OS Detection
// ---------------------------------------------------------------------------
(function detectOS() {
  const ua = navigator.userAgent || navigator.platform || '';
  if (/Win/i.test(ua)) state.os = 'windows';
  else if (/Mac/i.test(ua)) state.os = 'macos';
  if (state.os) {
    setTimeout(() => {
      const cards = document.querySelectorAll('#osCards .card');
      cards.forEach(c => {
        if (c.dataset.value === state.os) { c.classList.add('selected'); document.getElementById('step1Next').disabled = false; }
      });
    }, 0);
  }
})();

// ---------------------------------------------------------------------------
// Navigation
// ---------------------------------------------------------------------------
function goToStep(n) {
  document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
  const target = document.querySelector(`.step[data-step="${n}"]`);
  if (target) target.classList.add('active');
  updateProgress(n);
  window.scrollTo({ top: 0, behavior: 'smooth' });

  // Dynamic content rendering
  if (n === 4) renderStep4();
  if (n === 6) renderStep6();
  if (n === 7) renderStep7();
  if (n === 8) renderStep8();
}

function updateProgress(step) {
  const bar = document.getElementById('progressBar');
  bar.innerHTML = '';
  for (let i = 0; i < TOTAL_STEPS; i++) {
    const dot = document.createElement('div');
    dot.className = 'progress-dot' + (i < step ? ' done' : '') + (i === step ? ' active' : '');
    bar.appendChild(dot);
  }
}
updateProgress(0);

// ---------------------------------------------------------------------------
// Card Selection
// ---------------------------------------------------------------------------
function selectCard(field, value, el) {
  const parent = el.parentElement;
  parent.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
  el.classList.add('selected');
  if (field === 'os' || field === 'chatPlatform' || field === 'aiProvider' || field === 'personality') {
    state[field] = value;
  }
  // Enable next buttons
  const stepMap = { os: 'step1Next', chatPlatform: 'step2Next', aiProvider: 'step3Next' };
  if (stepMap[field]) document.getElementById(stepMap[field]).disabled = false;
  if (field === 'personality') validateStep5();
}

// ---------------------------------------------------------------------------
// Expandable / Accordion
// ---------------------------------------------------------------------------
function toggleExpand(btn) {
  btn.classList.toggle('open');
  const content = btn.nextElementSibling;
  content.classList.toggle('open');
}

function toggleAccordion(header) {
  const body = header.nextElementSibling;
  body.classList.toggle('open');
}

// ---------------------------------------------------------------------------
// Help Panel
// ---------------------------------------------------------------------------
const faqData = [
  { q: 'What is FreeClaw?', a: 'FreeClaw is a free setup wizard that helps you create your own AI chatbot. It generates a script that installs and configures OpenClaw on your computer.' },
  { q: 'What is OpenClaw?', a: 'OpenClaw is an open-source personal AI assistant platform. It connects AI models (like Claude or ChatGPT) to your messaging apps. FreeClaw makes it easy to set up.' },
  { q: 'Is this safe?', a: 'Yes. FreeClaw runs entirely in your browser - your API keys and tokens never leave your computer. The generated script only downloads from official sources (nodejs.org, github.com). No data is sent to FreeClaw servers.' },
  { q: 'How much does the AI cost?', a: 'You pay your AI provider directly based on usage. Typical casual use costs $1-5/month. Claude: ~$3/million input tokens. ChatGPT: ~$2.50/million input tokens. Gemini: has a generous free tier.' },
  { q: 'Can I change the AI model later?', a: 'Yes. Edit ~/.openclaw/openclaw.json and change the model in agents.defaults.model.primary, or run "openclaw configure" in your terminal.' },
  { q: 'How do I stop the bot?', a: 'Close the terminal window. To stop the background service on Mac: run "launchctl bootout gui/$(id -u)/ai.openclaw.gateway" in Terminal. On Windows: close the FreeClaw window or remove it from startup apps.' },
  { q: 'How do I uninstall?', a: 'Delete the ~/freeclaw folder (portable Node.js runtime) and the ~/.openclaw folder (config and data). On Mac, also stop the service first.' },
  { q: 'Can I use this on my phone?', a: 'FreeClaw sets up the bot on your desktop computer. Once running, you can chat with the bot from any device through your chosen messaging app.' },
];

function openHelp() { document.getElementById('helpOverlay').classList.add('open'); }
function closeHelp() { document.getElementById('helpOverlay').classList.remove('open'); }

(function renderFAQ() {
  const list = document.getElementById('faqList');
  faqData.forEach(item => {
    const div = document.createElement('div');
    div.className = 'faq-item';
    div.innerHTML = `<div class="faq-q" onclick="this.nextElementSibling.classList.toggle('open')">${item.q} <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg></div><div class="faq-a">${item.a}</div>`;
    list.appendChild(div);
  });
})();

// ---------------------------------------------------------------------------
// Step 4: Dynamic content
// ---------------------------------------------------------------------------
function renderStep4() {
  renderApiKeyGuide();
  renderPlatformGuide();
  validateStep4();
}

function renderApiKeyGuide() {
  const p = providerMap[state.aiProvider];
  if (!p) return;
  const guides = {
    anthropic: [
      'Go to <a href="https://console.anthropic.com/settings/keys" target="_blank" rel="noopener">console.anthropic.com</a>',
      'Sign up or log in',
      'Click "API Keys" in the left sidebar',
      'Click "Create Key"',
      'Copy the key (starts with <code>sk-ant-</code>)'
    ],
    openai: [
      'Go to <a href="https://platform.openai.com/api-keys" target="_blank" rel="noopener">platform.openai.com</a>',
      'Sign up or log in',
      'Click your profile icon, then "API Keys"',
      'Click "Create new secret key"',
      'Copy the key (starts with <code>sk-</code>)'
    ],
    google: [
      'Go to <a href="https://aistudio.google.com/apikey" target="_blank" rel="noopener">aistudio.google.com</a>',
      'Sign in with your Google account',
      'Click "Get API Key"',
      'Click "Create API key"',
      'Copy the key'
    ]
  };
  const el = document.getElementById('apiKeyGuide');
  el.innerHTML = `
    <p class="section-label">${p.name} API Key</p>
    <ol class="steps-list">${guides[state.aiProvider].map(s => `<li>${s}</li>`).join('')}</ol>
    <div class="input-group" style="margin-top:1rem">
      <label class="input-label">Paste your API key</label>
      <div class="input-wrap">
        <input type="password" id="apiKeyInput" placeholder="${p.prefix}..." oninput="onApiKeyInput(this)">
        <button class="input-toggle" onclick="togglePassword('apiKeyInput',this)" title="Show/hide">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
        </button>
      </div>
      <div class="input-hint">Your key never leaves your browser.</div>
      <div class="input-error" id="apiKeyError">Key format doesn't look right. Check and try again.</div>
      <div class="input-success" id="apiKeySuccess">Format looks good.</div>
    </div>`;
}

function onApiKeyInput(el) {
  state.apiKey = el.value.trim();
  const p = providerMap[state.aiProvider];
  const err = document.getElementById('apiKeyError');
  const ok = document.getElementById('apiKeySuccess');
  err.style.display = 'none';
  ok.style.display = 'none';
  if (state.apiKey.length > 8) {
    if (p.prefix && !state.apiKey.startsWith(p.prefix)) {
      err.style.display = 'block';
    } else {
      ok.style.display = 'block';
    }
  }
  validateStep4();
}

function renderPlatformGuide() {
  const el = document.getElementById('platformGuide');
  const guides = {
    telegram: `
      <p class="section-label">Telegram Bot Setup</p>
      <ol class="steps-list">
        <li>Open Telegram on your phone or computer</li>
        <li>Search for <strong>@BotFather</strong> and open the chat</li>
        <li>Send the message: <code>/newbot</code></li>
        <li>BotFather will ask for a name - type anything (e.g., "My AI Assistant")</li>
        <li>BotFather will ask for a username - type something ending in "bot" (e.g., "myai_helper_bot")</li>
        <li>BotFather will give you a token - copy it</li>
      </ol>
      <div class="input-group"><label class="input-label">Bot Token</label><div class="input-wrap"><input type="password" id="tgToken" placeholder="123456:ABC-DEF..." oninput="state.telegram.botToken=this.value.trim();validateStep4()"><button class="input-toggle" onclick="togglePassword('tgToken',this)"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button></div></div>
      <div class="input-group"><label class="input-label">Bot Username</label><div class="input-wrap"><input type="text" id="tgUsername" placeholder="myai_helper_bot" oninput="state.telegram.botUsername=this.value.trim().replace(/^@/,'');validateStep4()"></div><div class="input-hint">The username you chose, without the @ sign</div></div>`,
    discord: `
      <p class="section-label">Discord Bot Setup</p>
      <ol class="steps-list">
        <li>Go to <a href="https://discord.com/developers/applications" target="_blank" rel="noopener">discord.com/developers/applications</a></li>
        <li>Click "New Application" and name it</li>
        <li>Go to the "Bot" tab on the left</li>
        <li>Click "Reset Token" and copy the token</li>
        <li>Scroll down and enable <strong>Message Content Intent</strong></li>
        <li>Go to "OAuth2" &gt; "URL Generator"</li>
        <li>Check "bot" under Scopes, then check "Send Messages" and "Read Message History"</li>
        <li>Copy the generated URL at the bottom and open it to add your bot to a server</li>
      </ol>
      <div class="input-group"><label class="input-label">Bot Token</label><div class="input-wrap"><input type="password" id="discordToken" placeholder="Bot token" oninput="state.discord.token=this.value.trim();validateStep4()"><button class="input-toggle" onclick="togglePassword('discordToken',this)"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button></div></div>
      <div class="input-group"><label class="input-label">Server ID</label><div class="input-wrap"><input type="text" id="discordServer" placeholder="123456789012345678" oninput="state.discord.serverId=this.value.trim();validateStep4()"></div><div class="input-hint">Right-click your server name &gt; "Copy Server ID" (enable Developer Mode in Settings &gt; Advanced)</div></div>`,
    whatsapp: `
      <p class="section-label">WhatsApp Setup</p>
      <div class="notice">WhatsApp uses QR code pairing - no token needed! After running the setup script, a QR code will appear in your terminal. Scan it with WhatsApp on your phone.</div>
      <ol class="steps-list">
        <li>Run the setup script (next step)</li>
        <li>A QR code will appear in the terminal window</li>
        <li>Open WhatsApp on your phone</li>
        <li>Go to <strong>Settings &gt; Linked Devices &gt; Link a Device</strong></li>
        <li>Scan the QR code shown in your terminal</li>
      </ol>`,
    slack: `
      <p class="section-label">Slack Bot Setup</p>
      <ol class="steps-list">
        <li>Go to <a href="https://api.slack.com/apps" target="_blank" rel="noopener">api.slack.com/apps</a></li>
        <li>Click "Create New App" &gt; "From scratch"</li>
        <li>Name your app and select your workspace</li>
        <li>Go to "OAuth & Permissions" and add Bot Token Scopes: <code>chat:write</code>, <code>app_mentions:read</code>, <code>im:history</code>, <code>im:read</code>, <code>im:write</code></li>
        <li>Click "Install to Workspace" and authorize</li>
        <li>Copy the <strong>Bot User OAuth Token</strong> (starts with <code>xoxb-</code>)</li>
        <li>Go to "Socket Mode" and enable it</li>
        <li>Generate an App-Level Token with <code>connections:write</code> scope (starts with <code>xapp-</code>)</li>
        <li>Go to "Event Subscriptions", enable events, add: <code>message.im</code>, <code>app_mention</code></li>
      </ol>
      <div class="input-group"><label class="input-label">Bot Token</label><div class="input-wrap"><input type="password" id="slackBot" placeholder="xoxb-..." oninput="state.slack.botToken=this.value.trim();validateStep4()"><button class="input-toggle" onclick="togglePassword('slackBot',this)"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button></div></div>
      <div class="input-group"><label class="input-label">App Token</label><div class="input-wrap"><input type="password" id="slackApp" placeholder="xapp-..." oninput="state.slack.appToken=this.value.trim();validateStep4()"><button class="input-toggle" onclick="togglePassword('slackApp',this)"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button></div></div>`
  };
  el.innerHTML = guides[state.chatPlatform] || '';
}

function validateStep4() {
  let valid = state.apiKey.length > 8;
  switch (state.chatPlatform) {
    case 'telegram': valid = valid && state.telegram.botToken.length > 10 && state.telegram.botUsername.length > 2; break;
    case 'discord': valid = valid && state.discord.token.length > 10 && state.discord.serverId.length > 10; break;
    case 'whatsapp': break;
    case 'slack': valid = valid && state.slack.botToken.length > 10 && state.slack.appToken.length > 10; break;
  }
  const btn = document.getElementById('step4Next');
  if (btn) btn.disabled = !valid;
}

function validateStep5() {
  const name = document.getElementById('userName').value.trim();
  state.userName = name;
  state.customInstructions = (document.getElementById('customInstructions').value || '').trim();
  const btn = document.getElementById('step5Next');
  if (btn) btn.disabled = !(name.length > 0 && state.personality);
}

function togglePassword(id, btn) {
  const input = document.getElementById(id);
  input.type = input.type === 'password' ? 'text' : 'password';
}

// ---------------------------------------------------------------------------
// Step 6: Download filename
// ---------------------------------------------------------------------------
function renderStep6() {
  const fname = state.os === 'windows' ? 'freeclaw-setup.bat' : 'freeclaw-setup.command';
  document.getElementById('downloadFilename').textContent = fname;
  const step2el = document.getElementById('scriptStep2');
  if (step2el) step2el.style.display = state.os === 'windows' ? '' : 'none';
}

// ---------------------------------------------------------------------------
// Step 7: Run instructions
// ---------------------------------------------------------------------------
function renderStep7() {
  const el = document.getElementById('runInstructions');
  const troubleEl = document.getElementById('troubleRun');
  if (state.os === 'windows') {
    el.innerHTML = `<ol class="steps-list">
      <li>Find the downloaded file - usually in your <strong>Downloads</strong> folder</li>
      <li>Double-click <code>freeclaw-setup.bat</code></li>
      <li>Windows might show a warning - click <strong>"More info"</strong>, then <strong>"Run anyway"</strong></li>
      <li>Wait 2-3 minutes for setup to complete</li>
      <li>Your bot will start and your chat app will open</li>
    </ol>`;
    troubleEl.innerHTML = 'Right-click the file and select "Run as administrator". Make sure the file extension is <code>.bat</code>, not <code>.bat.txt</code>.';
  } else {
    el.innerHTML = `<ol class="steps-list">
      <li>Find the downloaded file - usually in your <strong>Downloads</strong> folder</li>
      <li><strong>Right-click</strong> the file and select <strong>"Open"</strong> (don't double-click)</li>
      <li>Click <strong>"Open"</strong> in the dialog that appears</li>
      <li>Enter your Mac login password if asked</li>
      <li>Wait 2-3 minutes for setup to complete</li>
      <li>Your bot will start and your chat app will open</li>
    </ol>`;
    troubleEl.innerHTML = 'Open Terminal and run: <code>chmod +x ~/Downloads/freeclaw-setup.command && open ~/Downloads/freeclaw-setup.command</code>';
  }
}

// ---------------------------------------------------------------------------
// Step 8: Success
// ---------------------------------------------------------------------------
function renderStep8() {
  const btn = document.getElementById('openChatBtn');
  const msg = document.getElementById('successMsg');
  switch (state.chatPlatform) {
    case 'telegram':
      btn.href = 'https://t.me/' + encodeURIComponent(state.telegram.botUsername);
      btn.textContent = 'Open Telegram';
      msg.textContent = 'Open Telegram and send your bot a message!';
      break;
    case 'discord':
      btn.href = 'https://discord.com/channels/@me';
      btn.textContent = 'Open Discord';
      msg.textContent = 'Open Discord and message your bot!';
      break;
    case 'whatsapp':
      btn.href = '#';
      btn.textContent = 'Open WhatsApp';
      btn.onclick = function(e) { e.preventDefault(); alert('Check your terminal for the QR code, then scan it with WhatsApp.'); };
      msg.textContent = 'Scan the QR code in your terminal with WhatsApp.';
      break;
    case 'slack':
      btn.href = 'https://app.slack.com';
      btn.textContent = 'Open Slack';
      msg.textContent = 'Open Slack and message your bot!';
      break;
  }
  const shareText = encodeURIComponent('Just set up my own AI chatbot in 2 minutes with FreeClaw - no coding needed. https://freeclaw.co');
  document.getElementById('tweetLink').href = 'https://twitter.com/intent/tweet?text=' + shareText;
}

function copyShareText() {
  navigator.clipboard.writeText('Just set up my own AI chatbot in 2 minutes with FreeClaw - no coding needed. https://freeclaw.co').then(() => {
    const btn = event.target;
    const orig = btn.textContent;
    btn.textContent = 'Copied!';
    setTimeout(() => btn.textContent = orig, 2000);
  });
}

// ---------------------------------------------------------------------------
// Input Sanitization
// ---------------------------------------------------------------------------
function escapeJSON(str) {
  return JSON.stringify(str).slice(1, -1);
}

function escapePowerShell(str) {
  return str.replace(/'/g, "''");
}

function toBase64(str) {
  return btoa(unescape(encodeURIComponent(str)));
}

function psWriteFileB64(filePath, b64) {
  return `powershell -NoProfile -ExecutionPolicy Bypass -Command "$b='${b64}';$t=[System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($b));[System.IO.File]::WriteAllText('${filePath}',$t,(New-Object System.Text.UTF8Encoding $false))"`;
}

function escapeShell(str) {
  return str.replace(/\\/g, '\\\\').replace(/"/g, '\\"').replace(/\$/g, '\\$').replace(/`/g, '\\`');
}

function containsInjection(str) {
  const patterns = [/;\s*(rm|curl|wget|bash|sh|eval|exec|del|format|shutdown)/i, /\$\(/, /`[^`]+`/, /\|\s*\w/];
  return patterns.some(p => p.test(str));
}

function sanitize(str) {
  if (containsInjection(str)) return str.replace(/[;&|`$(){}]/g, '');
  return str;
}

function generateRandomToken() {
  const chars = 'abcdef0123456789';
  let token = '';
  for (let i = 0; i < 48; i++) token += chars[Math.floor(Math.random() * chars.length)];
  return token;
}

// ---------------------------------------------------------------------------
// Build OpenClaw JSON config
// ---------------------------------------------------------------------------
function buildConfigJSON() {
  const p = providerMap[state.aiProvider];
  const config = {
    agents: { defaults: { workspace: '~/.openclaw/workspace', model: { primary: p.model } } },
    channels: {},
    gateway: { port: 18789, mode: 'local', bind: 'loopback', auth: { mode: 'token', token: generateRandomToken() } }
  };
  switch (state.chatPlatform) {
    case 'telegram':
      config.channels.telegram = { enabled: true, botToken: sanitize(state.telegram.botToken), dmPolicy: 'open', allowFrom: ['*'] };
      break;
    case 'discord':
      config.channels.discord = { enabled: true, token: sanitize(state.discord.token) };
      break;
    case 'whatsapp':
      config.channels.whatsapp = { dmPolicy: 'open', allowFrom: ['*'] };
      break;
    case 'slack':
      config.channels.slack = { enabled: true, botToken: sanitize(state.slack.botToken), appToken: sanitize(state.slack.appToken) };
      break;
  }
  return JSON.stringify(config, null, 2);
}

function buildSOUL() {
  const p = personalities[state.personality] || personalities.friendly;
  let soul = `# SOUL.md - Who You Are\n\n## Identity\nYou are a personal AI assistant for ${sanitize(state.userName)}.\n\n## Core Behavior\n${p}\n`;
  if (state.customInstructions.trim()) {
    soul += `\n## Special Instructions\n${sanitize(state.customInstructions)}\n`;
  }
  return soul;
}

function buildUSER() {
  return `# USER.md - About Your Human\n\n- **Name:** ${sanitize(state.userName)}\n- **What to call them:** ${sanitize(state.userName)}\n\n## Context\n\n*(Your bot will learn about you over time. You can edit this file to add more context.)*\n`;
}

function buildAGENTS() {
  return `# AGENTS.md - Your Workspace\n\nThis folder is home.\n\n## Every Session\n\nBefore doing anything else:\n1. Read SOUL.md - this is who you are\n2. Read USER.md - this is who you're helping\n\n## Safety\n\n- Don't share private info\n- Ask before taking external actions\n- When in doubt, ask\n`;
}

// ---------------------------------------------------------------------------
// Windows Script Generator
// ---------------------------------------------------------------------------
function generateWindowsScript() {
  const p = providerMap[state.aiProvider];
  const configB64 = toBase64(buildConfigJSON());
  const soulB64 = toBase64(buildSOUL());
  const userB64 = toBase64(buildUSER());
  const agentsB64 = toBase64(buildAGENTS());
  const apiKey = sanitize(state.apiKey);

  let openCmd = '';
  switch (state.chatPlatform) {
    case 'telegram': openCmd = `start https://t.me/${sanitize(state.telegram.botUsername)}`; break;
    case 'discord': openCmd = 'start https://discord.com/channels/@me'; break;
    case 'whatsapp': openCmd = 'echo Please scan the QR code shown above with WhatsApp.'; break;
    case 'slack': openCmd = 'start https://app.slack.com'; break;
  }

  return `@echo off
setlocal EnableExtensions
chcp 65001 >nul 2>&1
title FreeClaw Setup

echo.
echo   ___              ___ _
echo  / __\\ __ ___  ___/ __\\ ^| __ ___      __
echo / _\\^| '__/ _ \\/ _ \\ /  ^| ^|/ _\` \\ \\ /\\ / /
echo / /  ^| ^| ^|  __/  __/ /\\_^| ^| (_^| ^\\ V  V /
echo \\/   ^|_^|  \\___^|\\___\\____/_^|\\__,_^| \\_/\\_/
echo.
echo   Your AI chatbot, running on your computer.
echo.

set "FREECLAW_HOME=%USERPROFILE%\\freeclaw"
set "OPENCLAW_HOME=%USERPROFILE%\\.openclaw"
set "NODE_VER=22.13.0"

:: Check if already installed
if exist "%FREECLAW_HOME%\\node\\node.exe" (
    echo FreeClaw is already installed at %FREECLAW_HOME%
    set /p "REINSTALL=Reinstall? (Y/N): "
    if /i not "!REINSTALL!"=="Y" goto :START_BOT
    echo Reinstalling...
)

:: Step 1: Download Node.js
echo.
echo [1/6] Downloading Node.js %NODE_VER%...
mkdir "%FREECLAW_HOME%" 2>nul
powershell -NoProfile -ExecutionPolicy Bypass -Command "$ProgressPreference='SilentlyContinue'; try { Invoke-WebRequest -Uri 'https://nodejs.org/dist/v%NODE_VER%/node-v%NODE_VER%-win-x64.zip' -OutFile '%TEMP%\\freeclaw-node.zip' -UseBasicParsing } catch { Write-Host 'DOWNLOAD_FAILED'; exit 1 }"
if not exist "%TEMP%\\freeclaw-node.zip" (
    echo ERROR: Failed to download Node.js. Check your internet connection.
    pause & exit /b 1
)
echo       Done.

:: Step 2: Download Git
echo [2/6] Downloading Git...
powershell -NoProfile -ExecutionPolicy Bypass -Command "$ProgressPreference='SilentlyContinue'; try { Invoke-WebRequest -Uri 'https://github.com/git-for-windows/git/releases/download/v2.47.1.windows.1/MinGit-2.47.1-64-bit.zip' -OutFile '%TEMP%\\freeclaw-git.zip' -UseBasicParsing } catch { Write-Host 'DOWNLOAD_FAILED'; exit 1 }"
if not exist "%TEMP%\\freeclaw-git.zip" (
    echo ERROR: Failed to download Git. Check your internet connection.
    pause & exit /b 1
)
echo       Done.

:: Step 3: Extract
echo [3/6] Setting up...
powershell -NoProfile -ExecutionPolicy Bypass -Command "$ProgressPreference='SilentlyContinue'; if (Test-Path '%FREECLAW_HOME%\\node') { Remove-Item '%FREECLAW_HOME%\\node' -Recurse -Force }; Expand-Archive -Path '%TEMP%\\freeclaw-node.zip' -DestinationPath '%FREECLAW_HOME%\\node-temp' -Force; Get-ChildItem '%FREECLAW_HOME%\\node-temp\\node-v%NODE_VER%-win-x64' | Move-Item -Destination '%FREECLAW_HOME%\\node' -Force; Remove-Item '%FREECLAW_HOME%\\node-temp' -Recurse -Force -ErrorAction SilentlyContinue"
powershell -NoProfile -ExecutionPolicy Bypass -Command "$ProgressPreference='SilentlyContinue'; if (Test-Path '%FREECLAW_HOME%\\git') { Remove-Item '%FREECLAW_HOME%\\git' -Recurse -Force }; Expand-Archive -Path '%TEMP%\\freeclaw-git.zip' -DestinationPath '%FREECLAW_HOME%\\git' -Force"
del "%TEMP%\\freeclaw-node.zip" 2>nul
del "%TEMP%\\freeclaw-git.zip" 2>nul
echo       Done.

:: Set PATH
set "PATH=%FREECLAW_HOME%\\node;%FREECLAW_HOME%\\git\\cmd;%PATH%"

:: Step 4: Install OpenClaw
echo [4/6] Installing OpenClaw (this may take a minute)...
call "%FREECLAW_HOME%\\node\\npm.cmd" install -g openclaw@latest --no-fund --no-audit >"%FREECLAW_HOME%\\npm-log.txt" 2>&1
if errorlevel 1 (
    echo ERROR: Failed to install OpenClaw. Check %FREECLAW_HOME%\\npm-log.txt
    pause & exit /b 1
)
echo       Done.

:: Step 5: Configure
echo [5/6] Configuring your bot...
mkdir "%OPENCLAW_HOME%" 2>nul
mkdir "%OPENCLAW_HOME%\\workspace" 2>nul

:: Write config files using Base64 to avoid batch/PowerShell quoting issues
${psWriteFileB64('%OPENCLAW_HOME%\\openclaw.json', configB64)}
${psWriteFileB64('%OPENCLAW_HOME%\\workspace\\SOUL.md', soulB64)}
${psWriteFileB64('%OPENCLAW_HOME%\\workspace\\USER.md', userB64)}
${psWriteFileB64('%OPENCLAW_HOME%\\workspace\\AGENTS.md', agentsB64)}
echo       Done.

:: Step 6: Activate
echo [6/6] Starting your bot...

:: Run onboard for auth and daemon install
call "%FREECLAW_HOME%\\node\\npx.cmd" openclaw onboard --non-interactive --accept-risk --install-daemon --auth-choice ${p.authChoice} ${p.authFlag} "${apiKey}" --skip-channels --skip-skills --skip-health --workspace "%OPENCLAW_HOME%\\workspace" >"%FREECLAW_HOME%\\onboard-log.txt" 2>&1

:: Create Start.bat
(
echo @echo off
echo set "PATH=%FREECLAW_HOME%\\node;%FREECLAW_HOME%\\git\\cmd;%%PATH%%"
echo title FreeClaw
echo echo FreeClaw is running. Press Ctrl+C to stop.
echo call "%FREECLAW_HOME%\\node\\npx.cmd" openclaw gateway
echo pause
) > "%FREECLAW_HOME%\\Start.bat"

:: Open chat
${openCmd}

echo.
echo ============================================
echo   FreeClaw setup complete!
echo   Your bot is running.
echo ============================================
echo.
echo To restart your bot later, run:
echo   %FREECLAW_HOME%\\Start.bat
echo.
pause
exit /b 0

:START_BOT
set "PATH=%FREECLAW_HOME%\\node;%FREECLAW_HOME%\\git\\cmd;%PATH%"
call "%FREECLAW_HOME%\\node\\npx.cmd" openclaw gateway
pause
`;
}

// ---------------------------------------------------------------------------
// macOS Script Generator
// ---------------------------------------------------------------------------
function generateMacScript() {
  const p = providerMap[state.aiProvider];
  const configJSON = buildConfigJSON();
  const soulMD = buildSOUL();
  const userMD = buildUSER();
  const agentsMD = buildAGENTS();
  const apiKey = sanitize(state.apiKey);

  let openCmd = '';
  switch (state.chatPlatform) {
    case 'telegram': openCmd = `open "https://t.me/${sanitize(state.telegram.botUsername)}"`; break;
    case 'discord': openCmd = 'open "https://discord.com/channels/@me"'; break;
    case 'whatsapp': openCmd = 'echo "Please scan the QR code shown above with WhatsApp."'; break;
    case 'slack': openCmd = 'open "https://app.slack.com"'; break;
  }

  // Use unique heredoc delimiters to prevent collision with user content
  return `#!/bin/bash
set -e

# FreeClaw Setup - macOS

RED='\\033[0;31m'
GREEN='\\033[0;32m'
BLUE='\\033[0;34m'
PURPLE='\\033[0;35m'
BOLD='\\033[1m'
NC='\\033[0m'

clear
echo ""
echo -e "\${PURPLE}\${BOLD}"
echo "   ___              ___ _"
echo "  / __\\\\ __ ___  ___/ __\\\\ | __ ___      __"
echo " / _\\\\| '__/ _ \\\\/ _ \\\\ /  | |/ _\\\` \\\\ \\\\ /\\\\ / /"
echo "/ /  | | |  __/  __/ /\\\\_| | (_| |\\\\ V  V /"
echo "\\\\/   |_|  \\\\___|\\\\___|\\\\____/_|\\\\__,_| \\\\_/\\\\_/"
echo -e "\${NC}"
echo "  Your AI chatbot, running on your computer."
echo ""

FREECLAW_HOME="$HOME/freeclaw"
OPENCLAW_HOME="$HOME/.openclaw"
NODE_VER="22.13.0"

# Detect architecture
ARCH=$(uname -m)
if [ "$ARCH" = "arm64" ]; then
  NODE_URL="https://nodejs.org/dist/v\${NODE_VER}/node-v\${NODE_VER}-darwin-arm64.tar.gz"
else
  NODE_URL="https://nodejs.org/dist/v\${NODE_VER}/node-v\${NODE_VER}-darwin-x64.tar.gz"
fi

# Check if already installed
if [ -f "$FREECLAW_HOME/node/bin/node" ]; then
  echo "FreeClaw is already installed."
  read -p "Reinstall? (y/N): " REINSTALL
  if [ "$REINSTALL" != "y" ] && [ "$REINSTALL" != "Y" ]; then
    export PATH="$FREECLAW_HOME/node/bin:$PATH"
    exec npx openclaw gateway
  fi
fi

# Step 1: Download Node.js
echo -e "\${BLUE}[1/5]\${NC} Downloading Node.js \${NODE_VER} (\${ARCH})..."
mkdir -p "$FREECLAW_HOME"
curl -fsSL "$NODE_URL" -o "/tmp/freeclaw-node.tar.gz" || {
  echo -e "\${RED}ERROR: Failed to download Node.js. Check your internet connection.\${NC}"
  exit 1
}
echo "      Done."

# Step 2: Extract
echo -e "\${BLUE}[2/5]\${NC} Setting up..."
rm -rf "$FREECLAW_HOME/node"
mkdir -p "$FREECLAW_HOME/node"
tar -xzf "/tmp/freeclaw-node.tar.gz" -C "$FREECLAW_HOME/node" --strip-components=1
rm -f "/tmp/freeclaw-node.tar.gz"
export PATH="$FREECLAW_HOME/node/bin:$PATH"
echo "      Done."

# Step 3: Install OpenClaw
echo -e "\${BLUE}[3/5]\${NC} Installing OpenClaw (this may take a minute)..."
npm install -g openclaw@latest --no-fund --no-audit > "$FREECLAW_HOME/npm-log.txt" 2>&1 || {
  echo -e "\${RED}ERROR: Failed to install OpenClaw. Check $FREECLAW_HOME/npm-log.txt\${NC}"
  exit 1
}
echo "      Done."

# Step 4: Configure
echo -e "\${BLUE}[4/5]\${NC} Configuring your bot..."
mkdir -p "$OPENCLAW_HOME/workspace"

cat > "$OPENCLAW_HOME/openclaw.json" << 'FREECLAW_CONFIG_END'
${configJSON}
FREECLAW_CONFIG_END

cat > "$OPENCLAW_HOME/workspace/SOUL.md" << 'FREECLAW_SOUL_END'
${soulMD}
FREECLAW_SOUL_END

cat > "$OPENCLAW_HOME/workspace/USER.md" << 'FREECLAW_USER_END'
${userMD}
FREECLAW_USER_END

cat > "$OPENCLAW_HOME/workspace/AGENTS.md" << 'FREECLAW_AGENTS_END'
${agentsMD}
FREECLAW_AGENTS_END

# Remove quarantine
xattr -rd com.apple.quarantine "$FREECLAW_HOME" 2>/dev/null || true
xattr -rd com.apple.quarantine "$OPENCLAW_HOME" 2>/dev/null || true
echo "      Done."

# Step 5: Activate
echo -e "\${BLUE}[5/5]\${NC} Starting your bot..."

npx openclaw onboard --non-interactive --accept-risk \\
  --install-daemon \\
  --auth-choice ${p.authChoice} ${p.authFlag} "${escapeShell(apiKey)}" \\
  --skip-channels --skip-skills --skip-health \\
  --workspace "$OPENCLAW_HOME/workspace" > "$FREECLAW_HOME/onboard-log.txt" 2>&1 || true

# Create start script
cat > "$FREECLAW_HOME/start.sh" << 'FREECLAW_START_END'
#!/bin/bash
export PATH="$HOME/freeclaw/node/bin:$PATH"
echo "FreeClaw is running. Press Ctrl+C to stop."
npx openclaw gateway
FREECLAW_START_END
chmod +x "$FREECLAW_HOME/start.sh"

# Open chat
${openCmd}

echo ""
echo -e "\${GREEN}============================================\${NC}"
echo -e "\${GREEN}  FreeClaw setup complete!\${NC}"
echo -e "\${GREEN}  Your bot is running.\${NC}"
echo -e "\${GREEN}============================================\${NC}"
echo ""
echo "To restart your bot later, run:"
echo "  $FREECLAW_HOME/start.sh"
echo ""
`;
}

// ---------------------------------------------------------------------------
// Download
// ---------------------------------------------------------------------------
function downloadScript() {
  const config = { ...state };
  let content, filename, mime;
  if (state.os === 'windows') {
    content = generateWindowsScript();
    filename = 'freeclaw-setup.bat';
    mime = 'application/bat';
    content = content.replace(/\n/g, '\r\n');
  } else {
    content = generateMacScript();
    filename = 'freeclaw-setup.command';
    mime = 'text/plain';
  }
  const blob = new Blob([content], { type: mime });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}
  </script>
</body>
</html>
